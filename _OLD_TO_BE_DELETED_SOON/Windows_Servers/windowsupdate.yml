---
- name: Choose which Windows updates to install
  win_updates:
    category_names:
      - SecurityUpdates
      - CriticalUpdates
      - UpdateRollups

 #Check for missing updates
- name: Check for missing updates
        win_updates: state=searched
        register: update_count

- name: Install all critical and security updates
  win_updates:
    category_names:
    - CriticalUpdates
    - SecurityUpdates
    - UpdateRollups
    state: installed
  register: update_result

#install the updates and reboot if the result records a reboot is necessary
- name: reboot host if required
        win_reboot:
        when: update_result.reboot_required
